<launch>
  <arg name="gui" default="true" />
  <node name="play_face_bag" pkg="rosbag" type="play" args="-l $(find opencv_apps)/test/face_detector_withface_test_diamondback.bag" />

  <group ns="wide_stereo/left" >
    <node name="image_proc" pkg="image_proc" type="image_proc" />
    <node name="image_view" pkg="image_view" type="image_view" args="image:=image_rect_color" if="$(arg gui)" />

    <!-- calcHist for Color Image -->
    <include file="$(find opencv_apps)/launch/compare_histogram.launch" >
      <arg name="debug_view" value="$(arg gui)" />
      <arg name="image" value="image_rect_color" />
      <arg name="histogram_size" value="64" />
      <arg name="node_name" value="compare_histogram_color" />
    </include>

    <!-- calcHist for Gray Image -->
    <include file="$(find opencv_apps)/launch/compare_histogram.launch" >
      <arg name="debug_view" value="$(arg gui)" />
      <arg name="image" value="image_rect" />
      <arg name="histogram_size" value="32" />
      <arg name="reference_histogram" value="
         [[0.        , 0.0123726 , 0.43492851, 0.69198507, 0.55949336, 0.36090258,
           0.20119113, 0.23650548, 0.57807326, 0.74101412, 0.70817435, 0.72729945,
           0.68506479, 0.49020678, 0.32500106, 0.26422849, 0.46420333, 0.47376588,
           0.21146668, 0.18026255, 0.21356374, 0.24858449, 0.21540914, 0.24682297,
           0.30197543, 0.27785933, 0.27802709, 0.32470748, 0.40351465, 0.62638932,
           1.        , 0.40129179]]" />
      <arg name="node_name" value="compare_histogram_gray" />
    </include>

    <!-- Test Codes -->
    <node name="compare_histogram_color_saver" pkg="image_view" type="image_saver" >
      <param name="filename_format" value="$(find opencv_apps)/test/compare_histogram_color.png"/>
      <param name="queue_size" value="5" />
      <remap from="image" to="compare_histogram_color/image" />
      <remap from="compare_histogram_color/camera_info" to="camera_info" />
    </node>
    <node name="compare_histogram_gray_saver" pkg="image_view" type="image_saver" >
      <param name="filename_format" value="$(find opencv_apps)/test/compare_histogram_gray.png"/>
      <param name="queue_size" value="5" />
      <remap from="image" to="compare_histogram_gray/image" />
      <remap from="compare_histogram_gray/camera_info" to="camera_info" />
    </node>

    <param name="compare_histogram_color_test/topic" value="compare_histogram_color/image" />
    <test test-name="compare_histogram_color_test" pkg="rostest" type="hztest" name="compare_histogram_color_test" >
      <param name="hz" value="20" />
      <param name="hzerror" value="15" />
      <param name="test_duration" value="5.0" />
    </test>
    <param name="compare_histogram_gray_test/topic" value="compare_histogram_gray/image" />
    <test test-name="compare_histogram_gray_test" pkg="rostest" type="hztest" name="compare_histogram_gray_test" >
      <param name="hz" value="20" />
      <param name="hzerror" value="15" />
      <param name="test_duration" value="5.0" />
    </test>
    <param name="compare_histogram_gray_distance_test/topic" value="compare_histogram_gray/distance" />
    <test test-name="compare_histogram_gray_distance_test" pkg="rostest" type="hztest" name="compare_histogram_gray_distance_test" >
      <param name="hz" value="20" />
      <param name="hzerror" value="15" />
      <param name="test_duration" value="5.0" />
    </test>

  </group>
</launch>
